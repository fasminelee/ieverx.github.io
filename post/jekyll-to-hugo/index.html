<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta viewport="width=device-width, initial-scale=1" />

    
    <title>从Jekyll迁移到Hugo | 天外天</title>
    

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/code.github.css">
</head>

<body>
    <div class="container">
        <div class="block-container">
            <div id="header" class="header">
    <div class="header-container">
        <div class="brand">
            <h1 class="u-link">
                <a href="/">天外天</a>
            </h1>
        </div>
        <div class="nav-container">
            <div class="nav">
                <div class="u-link nav-item">
                    <a href="/">home</a>
                </div>
                <div class="u-link nav-item">
                    <a href="/tags">tags</a>
                </div>
                
                <div class="u-link nav-item">
                    <a href="https://github.com/ieverx">project</a>
                </div>
                
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
            
<div class="block-single">
    <div class="post">    
    <h1 class="post-title">从Jekyll迁移到Hugo</h1>
    <div class="post-meta">
    <span class="post-date">2018.3.10</span>
    
        &middot;
        
        <span class="post-tag u-link">
            <a href="/tags/jekyll">Jekyll</a>
        </span>
        
        <span class="post-tag u-link">
            <a href="/tags/hugo">Hugo</a>
        </span>
        
        <span class="post-tag u-link">
            <a href="/tags/travis-ci">Travis CI</a>
        </span>
        
    
</div>
    <div class="post-content">
        

<p>最近把博客从Jekyll迁移到了Hugo，在这里记录一下。</p>

<p>之前一直使用Jekyll，最大的原因是Github Pages原生支持Jekyll，
repo里只管理源代码就可以，不需要上传build之后的文件。
不过Jekyll也有许多不尽如人意的地方，主要是一下几点：</p>

<ul>
<li>本地开发环境不容易配置。
没有直接的可执行文件，需要安装ruby，gem，之后再安装jekyll</li>
<li>Github Pages的build配置不能按照自己的需求定制。
各种依赖的版本不能自己选择，也不能根据使用Jekyll的一些插件</li>
<li>编译速度慢。
因为本站的文章太少，这一点倒是不是什么问题</li>
</ul>

<h1 id="内容迁移">内容迁移</h1>

<p>博客从Jekyll迁移到Hugo，在考虑主题迁移的情况下，还是比较简单的。
Hugo的命令行可以直接从Jekyll导入文章，</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">hugo import jekyll /path/to/jekyll/root /target/path</code></pre></div>
<p>这样可以直接导入文章，Jekyll中其他的静态文件会被放到<code>static</code>文件夹中。
这个命令比较简单，但并没有把所有事情干完。只是把Jekyll中的文章放到了Hugo中，
并且根据文件名里的时间，放到了front matter中，其他并没有改动。
文件名也仍然需要自己手动修改，去掉时间。</p>

<p>此外，Hugo使用的markdown，在语法上也与Jekyll有些差异，渲染出来的html也是有些不同。
这里可以在Hugo的配置文件里进行修改，也可以修改文章的语法。</p>

<h1 id="自动编译">自动编译</h1>

<p>使用Jekyll的时候其实是不需要这一步的，直接推到github上就行了。
使用hugo，如果每次都是本地编译，然后把编译后的html文件推到github，
那就太不方便了。而且这样也不利于源码文件的管理。</p>

<h2 id="travis-ci">Travis CI</h2>

<p>Travis CI是持续集成服务，并且对于Github上的public repo是免费使用的。
利用Travis CI，可以达到每次push到Github上的时候，自动build，
并推送到repo的特定的分支。</p>

<p>首先需要在Travis CI上开启repo的自动集成，然后在repo里添加<code>.travis.yml</code>。
Travis CI会根据这个文件，进行build。根据<a href="https://docs.travis-ci.com/user/customizing-the-build">Travis CI的文档</a>，
build过程分为几个阶段。一个静态博客的build，比较简单，
也不用所有的过程都用上。在<code>install</code>阶段安装hugo，<code>script</code>阶段调用hugo进行编译，
<code>after_success</code>阶段把生成的文件推到github上。这是本站的使用的配置。</p>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="c"># .traivs.yml</span><span class="w">
</span><span class="w"></span>language<span class="p">:</span><span class="w"> </span>go<span class="w">
</span><span class="w"></span>go<span class="p">:</span><span class="w">
</span><span class="w"> </span>-<span class="w"> </span><span class="s1">&#39;1.10&#39;</span><span class="w">
</span><span class="w"></span>branches<span class="p">:</span><span class="w">
</span><span class="w">  </span>only<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>source<span class="w"> </span><span class="c"># 只有source分支的推送才触发构建</span><span class="w">
</span><span class="w"></span>install<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>wget<span class="w"> </span>/path/to/hugo/releases<span class="w"> </span>-O<span class="w"> </span>/tmp/hugo.tar.gz<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>bin<span class="w">
</span><span class="w">  </span>-<span class="w"> </span>tar<span class="w"> </span>-xvf<span class="w"> </span>/tmp/hugo.tar.gz<span class="w"> </span>-C<span class="w"> </span>bin<span class="w">
</span><span class="w"></span>script<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>bin/hugo<span class="w">
</span><span class="w"></span>after_success<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>sh<span class="w"> </span>.travis/push.sh</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># push.sh
</span><span class="c1"></span>setup_git<span class="o">()</span> <span class="o">{</span>
    git config --global user.name <span class="s2">&#34;travis@travis-ci.org&#34;</span>
    git config --global user.email <span class="s2">&#34;Travis CI&#34;</span>
<span class="o">}</span>

commit_files<span class="o">()</span> <span class="o">{</span>
    git init
    git add .
    git commit -m<span class="s2">&#34;Travis build: </span><span class="nv">$TRAVIS_BUILD_NUMBER</span><span class="s2">&#34;</span>
<span class="o">}</span>

push<span class="o">()</span> <span class="o">{</span>
    git remote add origin https://<span class="si">${</span><span class="nv">GH_TOKEN</span><span class="si">}</span>@github.com/yourname/yourrepo.git
    git push -f -u origin master
<span class="o">}</span>

<span class="nb">cd</span> public
setup_git
commit_files
push</code></pre></div>
<p>由于Travis CI并没有repo的push权限，所以直接推到repo上是会验证失败的。
<code>push.sh</code>里，<code>GH_TOKEN</code>是有<code>public_repo</code>权限的personal access token，
可以在<a href="https://github.com/settings/tokens">https://github.com/settings/tokens</a>申请，并在Travis CI上设置。</p>

<p>至此，Travis CI的自动build就完成了。</p>

    </div>
</div>
</div>

<h2 style="color: #777">评论</h2>
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "evercoding" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


            
        </div>
    </div>
    <div id="footer">
    <div class="footer-container">
        <div class="support">
            <div class="powered-by">本站由 <a href="https://gohugo.io">Hugo</a> 驱动</div>
            <div class="theme">采用 <a href="https://github.com/codvim">ink</a> 主题</div>
        </div>
    </div>
</div>
    
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-54098391-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</body>
</html>